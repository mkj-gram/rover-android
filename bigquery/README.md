# BigQuery

Bigquery archives all events generated by the Rover iOS and Android sdks as well as other internal models we have saved. This includes devices, profiles, experiences, etc. The goal of this project is to provide clients a historiacl view of all data Rover has collected and allow for easy exporting.


## Organization

This project follows the standard golang application guide found [here](https://github.com/RoverPlatform/rover/wiki/Go-Guidelines)

### Domain
Describes all the models used by the application

#### Event
An Event is a representation of the data collected from the Rover sdks through the graphql-gateway

#### Schema
The schema of the free flow attributes inside the event. This follows the same types as [events/backend/schema/types.go](https://github.com/RoverPlatform/rover/blob/master/events/backend/schema/types.go)

#### File
A file persisted to some storage. It is a collection of byte data newline delimited. This is used to buffer data on disk before flushing to bigquery. It allows us to generate large batches instead of streaming to bigquery which can be quite slow



## Table output

Bigquery is organized into datasets and tables. This project uses the datasets to distinguish between accounts. You'll notice the naming schema follows the pattern `account_${account_id}` where `account_id` is the id of the account saved in `auth`. This allows us to grant read priveleges on an account bases and have clients only be able to see their data. The table names generated start with the `v2` prefix to distinguish from the older version of data collection. Table names follow the pattern:
`v2_${event_namespace}_${event_name}_${schema_id}`. Example if a `Location Update` event is generated from our sdks and the schema generated has an id of `4` then the bigquery table will look as follows: `v2_rover_location_update_4`. In the case where the namespace of the event is empty it uses the pattern `v2_${event_name}_${schema_id}`