syntax = "proto3";

package rover.csv_processor.v1;

option go_package = "csv-processor/v1;csv-processor";

import "google/protobuf/timestamp.proto";
import "auth/v1/auth.proto";

enum JobType {
    SEGMENT = 0;
}

enum JobStatus {
    UNKNOWN = 0;
    ENQUEUED = 1;
    PROCESSING = 2;
    FAILED = 3;
    COMPLETED = 4;
}

message GCSObject {
    string project_id = 1;
    string bucket = 2;
    string file_id = 3;
}

message LoadJob {

    int32 id = 1;
    int32 account_id = 2;
    JobType type = 3;
    JobStatus status = 4;
    int32 progress = 5;
    google.protobuf.Timestamp created_at = 6;


    /* Optional */
    string failed_reason = 7;

}

message SegmentLoadJobConfig {
    int32 account_id = 1;
    int32 segment_id = 2;
    GCSObject csv = 3;
}

message GetLoadJobRequest {
    rover.auth.v1.AuthContext auth_context = 1;

    int32 load_job_id = 2;
}

message GetLoadJobReply {
    LoadJob job = 1;
}

message CreateLoadJobRequest {

    rover.auth.v1.AuthContext auth_context = 1;

    JobType type = 2;

    oneof job_config {
        SegmentLoadJobConfig segment_load_job_config = 3;
    }

}

message CreateLoadJobReply {
    LoadJob job = 1;
}

service CsvProcessor {
    
    rpc GetLoadJob(GetLoadJobRequest) returns (GetLoadJobReply) {};

    rpc CreateLoadJob(CreateLoadJobRequest) returns (CreateLoadJobReply) {};

}